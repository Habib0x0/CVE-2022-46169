#!/bin/bash


# Wait for the database to be ready
while ! mysqladmin ping -h"db" --silent; do
    echo "Waiting for database to be ready..."
    sleep 2
done

# Create the cacti database and user
mysql -h db -u root -p"root" -e "CREATE DATABASE cacti; GRANT ALL PRIVILEGES ON cacti.* TO 'cacti'@'%' IDENTIFIED BY 'cactipassword'; FLUSH PRIVILEGES;"

# Import the cacti database
mysql -h db -u cacti -p"cactipassword" cacti < /var/www/html/cacti/cacti.sql

# Update database settings
sed -i "s/\$database_type = 'mysql';/\$database_type = 'mysqli';/g" /var/www/html/cacti

chown www-data:www-data -R /var/www/html
# first arg is `-f` or `--some-option`
if [ "${1#-}" != "$1" ]; then
	set -- apache2-foreground "$@"
fi

exec "$@"
